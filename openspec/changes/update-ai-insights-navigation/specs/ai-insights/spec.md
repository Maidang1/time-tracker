## MODIFIED Requirements
### Requirement: Global Event Mood Insights
The system MUST provide an "AI 洞察" entry on the home page that summarizes stored events via DeepSeek, emphasizing event directions, inferred mood, and hobbies.
- MUST expose a visible trigger on `/pages/index` that navigates to a dedicated AI insights page.
- MUST collect up to the latest 10 events (including key stats/records) and combine them with a base prompt focused on event types/directions and persona inference.
- MUST allow the user to input optional free-form instructions before requesting analysis; combine base + user prompt when sending to DeepSeek.
- Response UI MUST show loading, success, and error states, and tag the output as "来自 DeepSeek".

#### Scenario: User requests all-event analysis with custom prompt
- **GIVEN** DeepSeek credentials are configured and there are at least 2 events stored
- **WHEN** the user opens the AI 洞察 page from the home entry, enters "更关注我的户外活动" in the prompt box, and taps "生成分析"
- **THEN** the app composes the default mood/type prompt with the user text, sends the aggregated events to DeepSeek, and
- **AND** the page shows a loading state until a response arrives
- **AND** once complete, displays the AI summary referencing event types, inferred moods/hobbies, and marks the message as generated by DeepSeek.

### Requirement: Event-Level Engagement Insight
The event detail screen MUST let users invoke DeepSeek to analyze that event's records (duration trends, note changes) and report engagement level, optionally guided by a user prompt.
- MUST present an AI 洞察 entry on the event detail header that navigates to a dedicated event AI insights page.
- MUST summarize the event's records (durations, order, note snippets) and compute simple stats (total time, avg, change over time) client-side before calling DeepSeek.
- MUST allow the user to provide extra instructions; combine them with the default engagement prompt.
- MUST show result text plus any emphasis (e.g., "投入程度", "建议") and provide retry/error UI.

#### Scenario: Event insight analyzes records trend
- **GIVEN** an event has at least 3 records with varying durations and notes
- **WHEN** the user taps the AI 洞察 entry on the event detail screen, optionally adds custom prompt text, and confirms the request
- **THEN** the app navigates to the event AI 洞察 page, sends the event summary data + merged prompt to DeepSeek, shows progress, and
- **AND** after success, renders the AI narrative describing duration changes, note themes, and engagement assessment for that event.

### Requirement: Prompt + Response UX Consistency
Both AI analyses MUST reuse a shared UI pattern for prompt input, invocation, and result display to keep user experience cohesive.
- MUST use the same component or visual style for prompt entry (label, multiline input, "生成" primary action, disable state) in both contexts.
- MUST persist the user's last free-form prompt text per context while the panel stays open, clearing it only when the user resets.
- MUST detect missing DeepSeek configuration on AI 洞察 entry click and prompt for configuration input (API Key, Base URL, Model) before enabling analysis.

#### Scenario: Missing DeepSeek config triggers configuration prompt
- **GIVEN** the app is launched without a saved DeepSeek configuration
- **WHEN** the user taps AI 洞察 on the home page or event detail header
- **THEN** the app shows a configuration dialog to collect DeepSeek connection details and save them locally before analysis is enabled.
